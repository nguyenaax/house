Of course. I have analyzed the Canvas for syntax errors and found a few critical issues that would prevent it from functioning correctly. The primary issue is that the entire block of JavaScript code is not wrapped in the necessary `<script>` tags, and the required Firebase library scripts are missing.

Here is a breakdown of the errors found:

1.  **Missing `<script>` Tags:** The main block of JavaScript at the bottom of the document, starting with `const loadingStatus = ...`, was not enclosed in `<script>` tags. The browser would treat this as plain text instead of executable code.
2.  **Missing Firebase Libraries:** The code calls multiple Firebase functions (like `initializeApp`, `getFirestore`, `signInAnonymously`, etc.) but the Firebase SDK scripts were never imported in the HTML. This would cause "function is not defined" errors in the browser console.
3.  **Missing Closing `</script>` Tag:** The script tag for Tailwind CSS in the `<head>` was missing its closing `</script>` tag.

I have corrected these errors in the updated Canvas below by adding the necessary Firebase scripts, properly wrapping your JavaScript code, and ensuring all tags are correctly formed.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance Housing Plot Live Draft Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importing a Fantasy-style font -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Base Styling */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #1a1c23; /* Dark stone color */
            /* Subtle stone texture using SVG */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><g fill="%23000" fill-opacity="0.1"><rect x="50" width="50" height="50"/><rect y="50" width="50" height="50"/></g></svg>');
        }
        
        /* Alliance Header Font */
        .alliance-font {
            font-family: 'Cinzel', serif;
        }

        /* Thematic Shadow/Border for Content Boxes - WoW UI Style */
        .alliance-panel {
            background-color: rgba(15, 23, 42, 0.8); /* Dark Slate, semi-transparent */
            backdrop-filter: blur(4px);
            border: 2px solid;
            border-image-source: linear-gradient(to top, #ffd700, #b8860b);
            border-image-slice: 1;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3), inset 0 0 10px rgba(0,0,0,0.5); /* Golden Glow and Inner Shadow */
        }
        
        /* Table Aesthetics */
        .table-header { 
            background-color: #111827; /* Very Dark Blue, almost black */
            border-bottom: 2px solid #ffd700; /* Golden separator */
        }
        tbody tr {
            transition: background-color 0.3s ease;
        }
        tbody tr:nth-child(odd) {
            background-color: rgba(30, 41, 59, 0.4);
        }
        tbody tr:hover {
            background-color: rgba(255, 215, 0, 0.1); /* Subtle gold on hover */
        }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #ffd700; border-radius: 4px; border: 1px solid #1e293b; } /* Gold accent */
        
        /* WoW-style Button */
        .wow-button {
            background: linear-gradient(180deg, #1e90ff 0%, #0056b3 100%); /* Alliance Blue Gradient */
            border: 1px solid #c4a867; /* Gold border */
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.3), 0 2px 2px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease-in-out;
        }
        .wow-button:hover {
            background: linear-gradient(180deg, #4caaff 0%, #1e90ff 100%);
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.4), 0 2px 4px rgba(0, 0, 0, 0.5);
            transform: translateY(-1px);
        }

    </style>
</head>
<body class="text-gray-100 min-h-screen p-4 sm:p-8">
<!-- FORCED REFRESH October 17 -->
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl sm:text-6xl font-extrabold text-yellow-400 alliance-font" style="text-shadow: 2px 2px 4px #000;">
                Grand Alliance Draft Board
            </h1>
            <p class="text-blue-300 mt-2 text-xl alliance-font">By Right of Conquest: Claim Your Lordship's Plot</p>
        </header>

        <!-- Main Content Area: Map (LARGE, Full Width) -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl alliance-panel mb-10">
            <h2 class="text-3xl font-bold mb-4 text-blue-400 text-center alliance-font">Available Plots Map (54 Total)</h2>
            <!-- Image source updated and container size increased -->
            <img 
                src="https://pbs.twimg.com/media/G2qVYZsXIAABwE4.jpg:large" 
                alt="Alliance Neighborhood House Plots Map with Numbers"
                class="w-full h-auto rounded-lg shadow-lg border-2 border-yellow-600"
                onerror="this.onerror=null; this.src='https://placehold.co/1200x675/1f2937/9ca3af?text=Error+Loading+Map+Check+URL';"
            >
            <p class="text-xs text-gray-400 mt-3 text-center">Reference this map for plot numbers during the live draft.</p>
            
            <!-- Claimed Plots List -->
            <div id="claimedPlotsList" class="mt-6 p-4 bg-gray-900 rounded-lg hidden border-2 border-yellow-700">
                <h3 class="text-xl font-semibold text-yellow-400 mb-3 alliance-font">Claimed Plots:</h3>
                <div id="claimedPlotsContent" class="flex flex-wrap gap-2 text-lg font-mono text-white">
                    <!-- Claimed plots will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Live Pick Order Results and Plan/Log (Side-by-Side below map) -->
        <div class="grid lg:grid-cols-2 gap-10">

            <!-- Live Pick Order Results -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl alliance-panel h-full">
                <h2 class="text-3xl font-bold mb-4 text-blue-400 alliance-font">Live Pick & Selection Log</h2>
                <div class="overflow-x-auto rounded-lg">
                    <table id="pickOrderTable" class="min-w-full divide-y divide-gray-700">
                        <thead class="table-header">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-400 uppercase tracking-wider">Rank (E)</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-400 uppercase tracking-wider">Champion (F)</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-400 uppercase tracking-wider">Plot Claimed (G)</th>
                            </tr>
                        </thead>
                        <tbody id="pickOrderBody" class="divide-y divide-gray-700">
                            <!-- Live pick data will be injected here by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Admin Controls Form -->
                <div class="mt-8 pt-4 border-t border-gray-700">
                    <h3 class="text-2xl font-bold mb-3 text-red-400 alliance-font">Organizer: Claim New Plot</h3>
                    <form id="pickForm" class="space-y-4">
                        <div id="loadingStatus" class="hidden p-2 text-center text-lg font-semibold bg-yellow-600 text-gray-900 rounded-md">Connecting...</div>
                        <div id="messageBox" class="hidden p-3 rounded-md text-sm font-medium"></div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="rankInput" class="block text-sm font-medium text-gray-400">Rank Number (1-26)</label>
                                <input type="number" id="rankInput" required min="1" max="26" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="winnerNameInput" class="block text-sm font-medium text-gray-400">Winner Name</label>
                                <input type="text" id="winnerNameInput" required class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div>
                            <label for="plotInput" class="block text-sm font-medium text-gray-400">Chosen Plot (1-54)</label>
                            <input type="text" id="plotInput" required class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter 'Plot X' or 'PENDING...'">
                        </div>
                        <button type="submit" class="w-full py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white wow-button">
                            Save Pick Result
                        </button>
                    </form>
                </div>
            </div>

            <!-- Detailed Plan and Entry Log -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl alliance-panel h-full">
                <h2 class="text-3xl font-bold mb-4 text-blue-400 alliance-font border-b-2 border-yellow-600/50 pb-2">Draft Process and Winner List</h2>

                <!-- Updated Content -->
                <div class="space-y-6 text-gray-300">
                    <h3 class="text-2xl font-bold text-gray-200 alliance-font"># Alliance Housing Plot Selection Plan</h3>
                    <p>The randomized pick order for the 26 guild members has been finalized (or will be finalized live). This board will track the selection process as each player claims their plot.</p>
                    
                    <h3 class="text-2xl font-bold text-gray-200 alliance-font">## Step 1: Final Pick Order List</h3>
                    <p>The names below represent the final 26 winners in the **randomized pick order**. The order in the table on the left (Rank 1 through 26) must match this list, ensuring transparency for the draft.</p>
                    
                    <h4 class="text-xl font-semibold text-yellow-400 alliance-font">### Champion Ranks</h4>
                    <div class="overflow-x-auto rounded-lg">
                        <table class="min-w-full divide-y divide-gray-700 border border-gray-700">
                            <thead class="table-header">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-400 uppercase tracking-wider">Rank</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-400 uppercase tracking-wider">Player Name</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700 bg-slate-800/50">
                                <!-- This list must be updated manually once the random draw is complete -->
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">1</td><td class="px-4 py-2 whitespace-nowrap text-sm">Duckiimist</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">2</td><td class="px-4 py-2 whitespace-nowrap text-sm">Kirikomain</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">3</td><td class="px-4 py-2 whitespace-nowrap text-sm">OshallÃ¡</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">4</td><td class="px-4 py-2 whitespace-nowrap text-sm">Cultzivate</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">5</td><td class="px-4 py-2 whitespace-nowrap text-sm">Meowlygos</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">6</td><td class="px-4 py-2 whitespace-nowrap text-sm">Ryxw</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">7</td><td class="px-4 py-2 whitespace-nowrap text-sm">Xephostwo</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">8</td><td class="px-4 py-2 whitespace-nowrap text-sm">Kevxh</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">9</td><td class="px-4 py-2 whitespace-nowrap text-sm">Tushytantrum</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">10</td><td class="px-4 py-2 whitespace-nowrap text-sm">Lygerxd</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">11</td><td class="px-4 py-2 whitespace-nowrap text-sm">Yakarue</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">12</td><td class="px-4 py-2 whitespace-nowrap text-sm">Bizzm</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">13</td><td class="px-4 py-2 whitespace-nowrap text-sm">Azunazx</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">14</td><td class="px-4 py-2 whitespace-nowrap text-sm">Akuwu</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">15</td><td class="px-4 py-2 whitespace-nowrap text-sm">Preyxd</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">16</td><td class="px-4 py-2 whitespace-nowrap text-sm">Fightdk</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">17</td><td class="px-4 py-2 whitespace-nowrap text-sm">Maverris</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">18</td><td class="px-4 py-2 whitespace-nowrap text-sm">Evne</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">19</td><td class="px-4 py-2 whitespace-nowrap text-sm">Garms</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">20</td><td class="px-4 py-2 whitespace-nowrap text-sm">Arzy</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">21</td><td class="px-4 py-2 whitespace-nowrap text-sm">Dabnel</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">22</td><td class="px-4 py-2 whitespace-nowrap text-sm">Subti</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">23</td><td class="px-4 py-2 whitespace-nowrap text-sm">Hypeboy</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">24</td><td class="px-4 py-2 whitespace-nowrap text-sm">Cququ</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">25</td><td class="px-4 py-2 whitespace-nowrap text-sm">Nerftank</td></tr>
                                <tr><td class="px-4 py-2 whitespace-nowrap text-sm">26</td><td class="px-4 py-2 whitespace-nowrap text-sm">Salisw</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-2xl font-bold text-gray-200 alliance-font">## Step 2: The Draft Protocol</h3>
                    <ol class="list-decimal list-inside ml-4 space-y-1">
                        <li>**Announce the Rank:** Announce the winner with the current Rank (1st, 2nd, etc.).</li>
                        <li>**The Selection:** The player announces their choice (e.g., "I choose Plot 18").</li>
                        <li>**Immediate Update:** The organizer uses the form on the left to enter the chosen plot. The **system will automatically check for duplicate claims.**</li>
                        <li>**Trade/Collision:** If a plot is already claimed, the organizer will be warned, allowing the player to choose again or initiate a trade discussion with the original claimant.</li>
                        <li>**Repeat:** Proceed to the next Rank until all available plots are claimed.</li>
                    </ol>
                    <p class="mt-4 p-3 bg-blue-900/30 border-l-4 border-yellow-500 rounded-md italic">
                        **Protocol Note:** Ensure all players have the live board link for maximum transparency. Hard refresh the page often during the draft!
                    </p>
                </div>
            </div>
        </div>

        <footer class="mt-12 text-center text-gray-500 text-sm">
            Draft Board generated by Guild Master (or your friendly AI Assistant). <span class="text-blue-500 font-semibold alliance-font">(v2.0 Alliance Theme & Final Auth Fix)</span>
        </footer>

    </div>

    <!-- CORRECTION: Added Firebase SDKs -->
    <!-- Replace with your project's snippet -->
    <script type="module">
        // TODO: Add your Firebase project's configuration here
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Import the functions you need from the SDKs you need
        // This is an example, make sure the version number is current
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        
        // CORRECTION: Wrapped all JS code inside a script tag
        const loadingStatus = document.getElementById('loadingStatus');
        const messageBox = document.getElementById('messageBox');
        const claimedPlotsList = document.getElementById('claimedPlotsList');
        const claimedPlotsContent = document.getElementById('claimedPlotsContent');
        
        let db, auth, currentPicksData = [];
        // Note: You need to define `appId` or replace it in the path below
        const appId = firebaseConfig.appId; // Using appId from config as an example
        const PICK_COLLECTION_PATH = `artifacts/${appId}/public/data/picks`;

        // Updated initial picks array with all 26 players
        const initialPicks = [
            { rank: 1, winnerName: "Duckiimist", chosenPlot: "PENDING..." },
            { rank: 2, winnerName: "Kirikomain", chosenPlot: "PENDING..." },
            { rank: 3, winnerName: "OshallÃ¡", chosenPlot: "PENDING..." },
            { rank: 4, winnerName: "Cultzivate", chosenPlot: "PENDING..." },
            { rank: 5, winnerName: "Meowlygos", chosenPlot: "PENDING..." },
            { rank: 6, winnerName: "Ryxw", chosenPlot: "PENDING..." },
            { rank: 7, winnerName: "Xephostwo", chosenPlot: "PENDING..." },
            { rank: 8, winnerName: "Kevxh", chosenPlot: "PENDING..." },
            { rank: 9, winnerName: "Tushytantrum", chosenPlot: "PENDING..." },
            { rank: 10, winnerName: "Lygerxd", chosenPlot: "PENDING..." },
            { rank: 11, winnerName: "Yakarue", chosenPlot: "PENDING..." },
            { rank: 12, winnerName: "Bizzm", chosenPlot: "PENDING..." },
            { rank: 13, winnerName: "Azunazx", chosenPlot: "PENDING..." },
            { rank: 14, winnerName: "Akuwu", chosenPlot: "PENDING..." },
            { rank: 15, winnerName: "Preyxd", chosenPlot: "PENDING..." },
            { rank: 16, winnerName: "Fightdk", chosenPlot: "PENDING..." },
            { rank: 17, winnerName: "Maverris", chosenPlot: "PENDING..." },
            { rank: 18, winnerName: "Evne", chosenPlot: "PENDING..." },
            { rank: 19, winnerName: "Garms", chosenPlot: "PENDING..." },
            { rank: 20, winnerName: "Arzy", chosenPlot: "PENDING..." },
            { rank: 21, winnerName: "Dabnel", chosenPlot: "PENDING..." },
            { rank: 22, winnerName: "Subti", chosenPlot: "PENDING..." },
            { rank: 23, winnerName: "Hypeboy", chosenPlot: "PENDING..." },
            { rank: 24, winnerName: "Cququ", chosenPlot: "PENDING..." },
            { rank: 25, winnerName: "Nerftank", chosenPlot: "PENDING..." },
            { rank: 26, winnerName: "Salisw", chosenPlot: "PENDING..." }
        ];

        // --- UTILITY FUNCTIONS ---

        function displayMessage(message, isError = false) {
            messageBox.innerHTML = message; // Use innerHTML to render bold/other tags
            messageBox.className = isError 
                ? 'p-3 rounded-md text-sm font-medium bg-red-800 text-red-100' 
                : 'p-3 rounded-md text-sm font-medium bg-green-800 text-green-100';
            messageBox.classList.remove('hidden');
        }

        // --- DATA MANAGEMENT & RENDERING ---

        async function initializePicksIfEmpty() {
            try {
                for (const pick of initialPicks) {
                    const pickDocRef = doc(db, PICK_COLLECTION_PATH, String(pick.rank));
                    await setDoc(pickDocRef, pick, { merge: true });
                }
            } catch (error) {
                console.error("Error initializing mock data:", error);
            }
        }

        function renderPicks(picks) {
            const tbody = document.getElementById('pickOrderBody');
            tbody.innerHTML = '';
            
            currentPicksData = picks.sort((a, b) => a.rank - b.rank);
            
            let claimedPlots = [];

            currentPicksData.forEach(pick => {
                let statusClass = 'text-gray-500';
                let rankText = pick.rank + ' Pick';
                let plotText = pick.chosenPlot;

                if (pick.rank <= 3) {
                    rankText = pick.rank === 1 ? '1st Pick' : pick.rank === 2 ? '2nd Pick' : '3rd Pick';
                }

                const plotMatch = pick.chosenPlot ? pick.chosenPlot.match(/plot\s*(\d+)/i) : null;

                if (plotMatch) {
                    statusClass = 'text-yellow-400';
                    claimedPlots.push(pick.chosenPlot);
                } else {
                    plotText = 'PENDING...';
                    statusClass = 'text-gray-500';
                }

                const row = document.createElement('tr');
                row.className = `transition duration-150`;
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap font-semibold ${pick.rank <= 3 ? 'font-extrabold' : ''} ${statusClass}">${rankText}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-lg">${pick.winnerName}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-lg font-mono ${plotText === 'PENDING...' ? 'text-red-400' : 'text-green-400'}">${plotText}</td>
                `;
                tbody.appendChild(row);
            });
            
            claimedPlotsContent.innerHTML = claimedPlots
                .map(plot => `<span class="bg-blue-700 p-1 rounded-md text-sm">${plot.replace(/plot\s*/i, 'P')}</span>`)
                .join('');
            if (claimedPlots.length > 0) {
                claimedPlotsList.classList.remove('hidden');
            } else {
                claimedPlotsList.classList.add('hidden');
            }

            loadingStatus.classList.add('hidden');
            displayMessage("Database Connected. Ready for Draft!", false);
        }

        function setupRealtimeListener() {
            console.log("Listening on path:", PICK_COLLECTION_PATH);
            const picksQuery = collection(db, PICK_COLLECTION_PATH);
            
            onSnapshot(picksQuery, (snapshot) => {
                const picks = [];
                snapshot.forEach(doc => {
                    picks.push(doc.data());
                });
                
                if (picks.length < initialPicks.length) {
                    initializePicksIfEmpty();
                } 
                renderPicks(picks);
            }, (error) => {
                console.error("Error setting up real-time listener:", error);
                displayMessage("Error listening for live updates. Check console for database path or rule issues.", true);
            });
        }

        // --- PLOT VALIDATION AND FORM SUBMISSION ---

        function setupFormSubmission() {
            const form = document.getElementById('pickForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const rankInput = document.getElementById('rankInput');
                const winnerNameInput = document.getElementById('winnerNameInput');
                const plotInput = document.getElementById('plotInput');

                const rank = parseInt(rankInput.value);
                const winnerName = winnerNameInput.value.trim();
                const chosenPlot = plotInput.value.trim();
                
                if (isNaN(rank) || rank < 1) {
                    displayMessage("Please enter a valid rank number.", true);
                    return;
                }

                const normalizedPlot = chosenPlot.match(/plot\s*(\d+)/i) ? chosenPlot.replace(/plot\s*/i, 'Plot ') : `Plot ${chosenPlot}`;
                
                const existingPick = currentPicksData.find(p => 
                    p.rank !== rank && 
                    p.chosenPlot && 
                    p.chosenPlot.toLowerCase() === normalizedPlot.toLowerCase()
                );

                if (existingPick) {
                    displayMessage(
                        `ðŸš« Plot <b>${normalizedPlot}</b> is already claimed by <b>${existingPick.winnerName}</b> (Rank ${existingPick.rank}).`, 
                        true
                    );
                    return;
                }
                
                loadingStatus.textContent = `Saving Pick ${rank}...`;
                loadingStatus.classList.remove('hidden');
                messageBox.classList.add('hidden');

                try {
                    const pickDocRef = doc(db, PICK_COLLECTION_PATH, String(rank));
                    
                    await setDoc(pickDocRef, {
                        rank: rank,
                        winnerName: winnerName,
                        chosenPlot: normalizedPlot
                    }, { merge: true });

                    displayMessage(`Successfully updated Rank ${rank} for ${winnerName}! Claimed ${normalizedPlot}!`, false);
                    form.reset(); 
                } catch (error) {
                    console.error("Error saving pick result:", error);
                    displayMessage(`Failed to save pick. Error: ${error.message}`, true);
                } finally {
                    loadingStatus.classList.add('hidden');
                }
            });
        }
        
        // --- AUTHENTICATION FLOW ---
        
        function initFirebase() {
            loadingStatus.textContent = "Connecting to Database...";
            loadingStatus.classList.remove('hidden');
            
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            signInAnonymously(auth).then(() => {
                console.log("Anonymous user signed in successfully.");
                loadingStatus.textContent = "Database Connected. Loading Picks...";
                setupRealtimeListener();
                setupFormSubmission();
            }).catch(error => {
                console.error("Anonymous Sign-In Failed:", error);
                displayMessage("Connection failed. Check Firebase config and Auth rules.", true);
                loadingStatus.classList.add('hidden');
            });
        }

        // Start the application
        window.onload = initFirebase;
    </script>
</body>
</html>
```
